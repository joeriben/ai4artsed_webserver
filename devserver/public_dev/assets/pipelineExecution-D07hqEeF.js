import{d as L,r as l,b as a}from"./index-IxyB1cSJ.js";import{a as T}from"./index-B9ygI19o.js";const p=T.create({baseURL:"/",timeout:12e4,headers:{"Content-Type":"application/json"}});p.interceptors.request.use(e=>(e.method?.toLowerCase()==="get"&&(e.params={...e.params,_t:Date.now()}),console.log(`[API] ${e.method?.toUpperCase()} ${e.url}`,e.params||""),e),e=>(console.error("[API] Request error:",e),Promise.reject(e)));p.interceptors.response.use(e=>{if(console.log(`[API] Response ${e.status} ${e.config.url}`),e.config.url?.includes("/api/")){const n=e.headers["cache-control"];console.log("[API] Cache-Control header:",n||"MISSING ⚠️")}return e},e=>(console.error("[API] Response error:",e.response?.status,e.response?.data),Promise.reject(e)));async function b(){return(await p.get("/pipeline_configs_with_properties")).data}async function A(e){const i=(await b()).configs.find(r=>r.id===e);if(!i)throw new Error(`Config not found: ${e}`);return i}async function j(e){return(await p.get(`/api/config/${e}/context`)).data}async function _(e){return(await p.post("/api/schema/pipeline/execute",e)).data}function R(e,n="image"){return`/api/media/${n}/${e}`}const U=L("pipelineExecution",()=>{const e=l(null),n=l(""),i=l(""),r=l(""),f=l("eco"),g=l("kids"),u=l(!1),c=l(null),d=l(""),m=a(()=>i.value!==r.value&&r.value!==""),v=a(()=>e.value!==null&&n.value.trim().length>0);async function x(t){u.value=!0,c.value=null,console.log(`[PipelineExecution] setConfig called with configId: "${t}"`);try{const o=await A(t);e.value=o,console.log("[PipelineExecution] Config loaded successfully:",{id:o.id,name:o.name,pipeline:o.pipeline})}catch(o){c.value=o instanceof Error?o.message:"Failed to load config",console.error("[PipelineExecution] Error loading config:",o)}finally{u.value=!1}}async function P(t){if(!e.value){console.warn("[PipelineExecution] loadMetaPromptForLanguage: No config selected");return}u.value=!0,c.value=null,console.log(`[PipelineExecution] loadMetaPromptForLanguage: configId="${e.value.id}", language="${t}"`);try{console.log(`[PipelineExecution] Fetching: GET /api/config/${e.value.id}/context`);const o=await j(e.value.id);console.log("[PipelineExecution] Context response:",{config_id:o.config_id,contextType:typeof o.context,contextKeys:typeof o.context=="object"?Object.keys(o.context):"N/A"});let s;typeof o.context=="string"?(console.log("[PipelineExecution] Context is string (old format)"),s=o.context):(console.log(`[PipelineExecution] Context is object, extracting language: ${t}`),s=o.context[t]||o.context.en||"",console.log(`[PipelineExecution] Extracted ${t} context (${s.length} chars): ${s.substring(0,80)}...`)),i.value=s,r.value=s,console.log(`[PipelineExecution] ✅ Meta-prompt set for ${e.value.id} (${t}): ${s.substring(0,50)}...`)}catch(o){c.value=o instanceof Error?o.message:"Failed to load meta-prompt",console.error("[PipelineExecution] ❌ Error loading meta-prompt:",o)}finally{u.value=!1}}function E(t){n.value=t}function y(t){i.value=t}function C(){i.value=r.value,console.log("[PipelineExecution] Meta-prompt reset to original")}function h(t){f.value=t}function $(t){g.value=t}function M(t){d.value=t,console.log("[PipelineExecution] Transformed prompt updated:",t.substring(0,100)+"...")}function w(){d.value="",console.log("[PipelineExecution] Transformed prompt cleared")}function I(){e.value=null,n.value="",i.value="",r.value="",d.value="",f.value="eco",g.value="kids",c.value=null,console.log("[PipelineExecution] State cleared")}return{selectedConfig:a(()=>e.value),userInput:a(()=>n.value),metaPrompt:a(()=>i.value),originalMetaPrompt:a(()=>r.value),transformedPrompt:a(()=>d.value),executionMode:a(()=>f.value),safetyLevel:a(()=>g.value),isLoading:a(()=>u.value),error:a(()=>c.value),metaPromptModified:m,isReadyToExecute:v,setConfig:x,loadMetaPromptForLanguage:P,updateUserInput:E,updateMetaPrompt:y,resetMetaPrompt:C,updateTransformedPrompt:M,clearTransformedPrompt:w,setExecutionMode:h,setSafetyLevel:$,clearAll:I}});export{_ as e,R as g,U as u};
