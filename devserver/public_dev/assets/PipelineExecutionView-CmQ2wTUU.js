import{e as D,I as T,r as v,b as R,g as F,w as V,c as d,f as B,a,A as L,t as s,i as M,B as O,p as N,o as c,_ as q,u as G,q as k,s as S,H as U,v as H,l as Z}from"./index-CxAVWkdj.js";import{u as j,g as J,e as K}from"./pipelineExecution-0tC6C8XI.js";import"./index-B9ygI19o.js";const Q={class:"bubble-header"},W={class:"header-left"},X={class:"bubble-icon"},Y={class:"bubble-title"},ee={class:"header-right"},te={key:0,class:"modified-badge"},ae=["title"],le=["placeholder"],se=["placeholder","maxlength"],oe=D({__name:"EditableBubble",props:{icon:{},title:{},modelValue:{},defaultValue:{},maxChars:{default:0},placeholder:{default:""}},emits:["update:modelValue"],setup(f,{emit:I}){const u=f,E=I,{t:z}=T(),t=v(null),n=v(u.modelValue),m=v(!1),p=v(!1),_=R(()=>n.value.length),b=R(()=>n.value!==u.defaultValue),y=R(()=>u.maxChars?_.value>u.maxChars*.9:!1);F(()=>{p.value=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),!p.value&&t.value&&(t.value.textContent=u.modelValue)}),V(()=>u.modelValue,i=>{n.value=i,!p.value&&t.value&&N(()=>{t.value&&t.value.textContent!==i&&(t.value.textContent=i)})});function C(i){const r=i.target;let o=r.textContent||"";if(u.maxChars&&o.length>u.maxChars){o=o.substring(0,u.maxChars),r.textContent=o;const g=window.getSelection(),e=document.createRange();e.selectNodeContents(r),e.collapse(!1),g?.removeAllRanges(),g?.addRange(e)}n.value=o,E("update:modelValue",o)}function h(){E("update:modelValue",n.value)}function $(){m.value=!1}function P(i){i.preventDefault();const r=i.clipboardData?.getData("text/plain")||"",o=window.getSelection();if(o&&o.rangeCount>0){const g=o.getRangeAt(0);g.deleteContents(),g.insertNode(document.createTextNode(r)),g.collapse(!1),o.removeAllRanges(),o.addRange(g)}t.value&&C({target:t.value})}function w(){n.value=u.defaultValue,E("update:modelValue",u.defaultValue),!p.value&&t.value&&N(()=>{t.value&&(t.value.textContent=u.defaultValue)})}return(i,r)=>(c(),d("div",{class:B(["editable-bubble",{"is-modified":b.value,"is-focused":m.value}])},[a("div",Q,[a("div",W,[a("span",X,s(f.icon),1),a("h3",Y,s(f.title),1)]),a("div",ee,[b.value?(c(),d("span",te,s(i.$t("phase2.modified")),1)):M("",!0),f.maxChars?(c(),d("span",{key:1,class:B(["char-count",{"is-near-limit":y.value}])},s(_.value)+" / "+s(f.maxChars),3)):M("",!0),b.value?(c(),d("button",{key:2,class:"reset-button",onClick:w,title:i.$t("phase2.reset")}," â†º ",8,ae)):M("",!0)])]),p.value?L((c(),d("textarea",{key:1,"onUpdate:modelValue":r[1]||(r[1]=o=>n.value=o),class:"bubble-content-textarea",placeholder:f.placeholder,maxlength:f.maxChars,onInput:h,onFocus:r[2]||(r[2]=o=>m.value=!0),onBlur:$},null,40,se)),[[O,n.value]]):(c(),d("div",{key:0,ref_key:"editableRef",ref:t,class:"bubble-content",contenteditable:"true",placeholder:f.placeholder,onInput:C,onFocus:r[0]||(r[0]=o=>m.value=!0),onBlur:$,onPaste:P},null,40,le))],2))}}),A=q(oe,[["__scopeId","data-v-52535353"]]),ne={class:"pipeline-execution-view"},ue={key:0,class:"loading-state"},ie={key:1,class:"error-state"},re={key:2,class:"execution-container"},de={class:"page-header"},ce={class:"header-left"},ve={class:"config-name"},pe={class:"header-right"},fe={class:"bubbles-container"},me={key:0,class:"bubble result-bubble"},he={class:"bubble-header"},ge={class:"header-left"},be={class:"bubble-title"},xe={class:"result-content"},_e=["src"],ye={class:"execute-section"},Ce=["disabled"],$e={key:0},ke={key:1},Pe={class:"execution-settings"},Ve={value:"eco"},Me={value:"fast"},Ee={value:"best"},Ie={value:"kids"},we={value:"youth"},Re={value:"adult"},Le=D({__name:"PipelineExecutionView",setup(f){const I=H(),u=Z(),{t:E,locale:z}=T(),t=j(),n=G(),m=v(""),p=v(""),_=v("eco"),b=v("kids"),y=v(!1),C=v(!1),h=v(null),$=v(null),P=v(null);function w(e){const l=n.language;return e.name[l]||e.name.en||e.id}async function i(){const e=I.params.configId;if(!e){h.value="No config ID provided";return}if(y.value=!0,await t.setConfig(e),t.error){h.value=t.error,y.value=!1;return}if(await t.loadMetaPromptForLanguage(n.language),t.error){h.value=t.error,y.value=!1;return}m.value=t.userInput,p.value=t.metaPrompt,_.value=t.executionMode,b.value=t.safetyLevel,y.value=!1}F(()=>{i()}),V(()=>n.language,async e=>{await t.loadMetaPromptForLanguage(e),p.value=t.metaPrompt}),V(m,e=>t.updateUserInput(e)),V(p,e=>t.updateMetaPrompt(e)),V(_,e=>t.setExecutionMode(e)),V(b,e=>t.setSafetyLevel(e));async function r(){if(!(!t.selectedConfig||!t.isReadyToExecute)){C.value=!0,$.value=null,P.value=null;try{const e={schema:t.selectedConfig.id,input_text:t.userInput,user_language:n.language,execution_mode:t.executionMode,safety_level:t.safetyLevel,...t.metaPromptModified&&{context_prompt:t.metaPrompt,context_language:n.language}};console.log("[Phase2] Executing pipeline:",e);const l=await K(e);if(l.status!=="success")throw new Error(l.error||"Execution failed");$.value=l.final_output||"No text output",l.media_output?.output&&(P.value=l.media_output.output),console.log("[Phase2] Execution successful:",l)}catch(e){h.value=e instanceof Error?e.message:"Execution failed",console.error("[Phase2] Execution error:",e)}finally{C.value=!1}}}function o(){u.push({name:"property-selection"})}function g(){h.value=null,i()}return(e,l)=>(c(),d("div",ne,[y.value?(c(),d("div",ue,[l[5]||(l[5]=a("div",{class:"loading-spinner"},null,-1)),a("p",null,s(e.$t("phase2.loadingConfig")),1)])):h.value?(c(),d("div",ie,[l[6]||(l[6]=a("div",{class:"error-icon"},"âŒ",-1)),a("h2",null,s(e.$t("phase2.errorLoadingConfig")),1),a("p",null,s(h.value),1),a("button",{class:"retry-button",onClick:g},s(e.$t("phase2.retry")||"Retry"),1)])):k(t).selectedConfig?(c(),d("div",re,[a("div",de,[a("div",ce,[a("button",{class:"back-button",onClick:o},"â† "+s(e.$t("phase2.back")||"ZurÃ¼ck"),1),a("h1",ve,s(w(k(t).selectedConfig)),1)]),a("div",pe,[a("button",{class:"language-toggle",onClick:l[0]||(l[0]=x=>k(n).toggleLanguage())},s(k(n).language==="de"?"ðŸ‡©ðŸ‡ª":"ðŸ‡¬ðŸ‡§"),1)])]),a("div",fe,[S(A,{icon:"âœï¸",title:e.$t("phase2.userInput"),modelValue:m.value,"onUpdate:modelValue":l[1]||(l[1]=x=>m.value=x),"default-value":"","max-chars":500,placeholder:e.$t("phase2.userInputPlaceholder"),class:"bubble user-input-bubble"},null,8,["title","modelValue","placeholder"]),S(A,{icon:"ðŸ§ ",title:e.$t("phase2.metaPrompt"),modelValue:p.value,"onUpdate:modelValue":l[2]||(l[2]=x=>p.value=x),"default-value":k(t).originalMetaPrompt,"max-chars":5e3,placeholder:e.$t("phase2.metaPromptPlaceholder"),class:"bubble meta-prompt-bubble"},null,8,["title","modelValue","default-value","placeholder"]),$.value?(c(),d("div",me,[a("div",he,[a("div",ge,[l[7]||(l[7]=a("span",{class:"bubble-icon"},"âœ¨",-1)),a("h3",be,s(e.$t("phase2.result")),1)])]),a("div",xe,[a("p",null,s($.value),1),P.value?(c(),d("img",{key:0,src:k(J)(P.value),alt:"Generated media",class:"generated-media"},null,8,_e)):M("",!0)])])):M("",!0)]),a("div",ye,[a("button",{class:"execute-button",disabled:!k(t).isReadyToExecute||C.value,onClick:r},[C.value?(c(),d("span",ke,s(e.$t("phase2.executing")),1)):(c(),d("span",$e,s(e.$t("phase2.execute")),1))],8,Ce),a("div",Pe,[L(a("select",{"onUpdate:modelValue":l[3]||(l[3]=x=>_.value=x),class:"setting-select"},[a("option",Ve,s(e.$t("executionModes.eco")),1),a("option",Me,s(e.$t("executionModes.fast")),1),a("option",Ee,s(e.$t("executionModes.best")),1)],512),[[U,_.value]]),L(a("select",{"onUpdate:modelValue":l[4]||(l[4]=x=>b.value=x),class:"setting-select"},[a("option",Ie,s(e.$t("safetyLevels.kids")),1),a("option",we,s(e.$t("safetyLevels.youth")),1),a("option",Re,s(e.$t("safetyLevels.adult")),1)],512),[[U,b.value]])])])])):M("",!0)]))}}),Ue=q(Le,[["__scopeId","data-v-fadc3b33"]]);export{Ue as default};
