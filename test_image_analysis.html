<!DOCTYPE html>
<html>
<head>
    <title>Test Image Analysis</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        button { padding: 10px 20px; margin: 10px; }
        textarea { width: 100%; height: 100px; }
        #result { margin-top: 20px; padding: 10px; background: #f0f0f0; }
        img { max-width: 200px; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Test Image Analysis</h1>
        
        <div>
            <label>Test Image (Base64):</label><br>
            <textarea id="imageData" placeholder="Paste base64 image data here...">data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==</textarea>
        </div>
        
        <div>
            <label>Prompt:</label><br>
            <input type="text" id="prompt" value="Ein schÃ¶nes Bild" style="width: 100%; padding: 5px;">
        </div>
        
        <div>
            <label>Workflow:</label><br>
            <input type="text" id="workflow" value="ai4artsed_MODEL_Stable-Diffusion-3.5_2507152202" style="width: 100%; padding: 5px;">
        </div>
        
        <button onclick="testStandardWithImage()">Test Standard Workflow with Image</button>
        <button onclick="testAnalyzeOnly()">Test Analyze Image Only</button>
        
        <div id="result"></div>
    </div>
    
    <script>
        async function testStandardWithImage() {
            const imageData = document.getElementById('imageData').value;
            const prompt = document.getElementById('prompt').value;
            const workflow = document.getElementById('workflow').value;
            
            const payload = {
                prompt: prompt,
                workflow: workflow,
                aspectRatio: '1:1',
                mode: 'fast',
                seedMode: 'random',
                safetyLevel: 'off',
                imageData: imageData,
                inputMode: 'standard_combined',
                requiresImageAnalysis: true
            };
            
            try {
                const response = await fetch('http://localhost:5001/run_workflow', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                const result = await response.json();
                document.getElementById('result').innerHTML = '<pre>' + JSON.stringify(result, null, 2) + '</pre>';
            } catch (e) {
                document.getElementById('result').innerHTML = 'Error: ' + e.message;
            }
        }
        
        async function testAnalyzeOnly() {
            const imageData = document.getElementById('imageData').value;
            
            try {
                const response = await fetch('http://localhost:5001/analyze_image', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ image: imageData })
                });
                
                const result = await response.json();
                document.getElementById('result').innerHTML = '<pre>' + JSON.stringify(result, null, 2) + '</pre>';
            } catch (e) {
                document.getElementById('result').innerHTML = 'Error: ' + e.message;
            }
        }
    </script>
</body>
</html>
